Ø³Ø£Ù‚ÙˆÙ… Ø¨ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø«Ù…Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø±ÙÙ‚Ø© ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø© ØªÙ†ÙÙŠØ°ÙŠØ© ØªÙ‚Ù†ÙŠØ© Ø´Ø§Ù…Ù„Ø© ÙˆÙ…ÙØµÙ„Ø© ØªØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø¯Ø³ØªÙˆØ± Apex v2 ÙˆÙ…Ø¹Ù…Ø§Ø±ÙŠØªÙ‡ Ø§Ù„Ù„ÙŠØºÙˆÙŠØ©.
Ø¥Ù„ÙŠÙƒ **Ø§Ù„Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø©** Ù„Ù€ Apex v2ØŒ Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø¯Ù‚ÙŠÙ‚ Ù„Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø«Ù…Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø±ÙÙ‚Ø©ØŒ Ù…Ø¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„Ø­Ø±ÙÙŠ Ø¨Ø§Ù„Ø¯Ø³ØªÙˆØ± Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ ÙˆÙ…Ø¹Ø§ÙŠÙŠØ± S1-S8.

---

# ğŸš€ APEX V2 - Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©

## 1. Ù‡ÙŠÙƒÙ„ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ (8-10 Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†)

### ğŸ¯ Lead Architect (1) - "Ø­Ø§Ø±Ø³ Ø§Ù„Ø¯Ø³ØªÙˆØ±"
**Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰:** Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø£ÙŠ Ø§Ù†Ø­Ø±Ø§Ù Ø¹Ù† Constitution.
- Ù…Ø±Ø§Ø¬Ø¹Ø© ÙƒÙ„ PR Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ **Cross-App Imports** (Rule 1.1).
- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ **S2 (Tenant Isolation)** ÙÙŠ ÙƒÙ„ Endpoint.
- ØªÙˆÙ‚ÙŠØ¹ Ù†Ù‡Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ ÙƒÙ„ Deploy.

### ğŸ›¡ï¸ Backend Security Leads (2)
**Engineer 1 - Core & Provisioning (Phase 1):**
- S1: Environment Verification (Zod + App Crash Ø¹Ù„Ù‰ Invalid Config).
- S2: Tenant Isolation Middleware (Schema-based).
- S4: Audit Logging Interceptor.
- **Provisioning Engine**: ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø°Ù‡Ø¨ÙŠ (<55 Ø«Ø§Ù†ÙŠØ©).

**Engineer 2 - Business Logic (Phase 2):**
- Checkout Module (Ù…Ø¹Ø²ÙˆÙ„ ØªÙ…Ø§Ù…Ø§Ù‹ Ø¹Ù† Ø¨Ù‚ÙŠØ© Ø§Ù„Ù†Ø¸Ø§Ù…).
- Product Catalog, RBAC System.

### ğŸ¨ Frontend Architects (3)
- **Storefront Lead:** Next.js 16 + Zustand + Tailwind.
- **Admin Lead:** Next.js 16 + Radix UI + Complex Forms.
- **Super Admin Lead:** Data Tables, God Mode UI, Kill Switch.

### ğŸ“± Mobile Lead (1)
- Expo + React Native + NativeWind.
- **Server-Driven UI Implementation** (Zero Rebuild Strategy).
- Integration Ù…Ø¹ `/api/mobile/config`.

### âš™ï¸ DevOps Engineers (2)
- Docker, Traefik, PostgreSQL, Redis, MinIO.
- CI/CD Pipeline (Turborepo + GitHub Actions).

### ğŸ§ª QA Automation Lead (1)
- Vitest, E2E Testing.
- **Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØªØ­Ù‚ÙŠÙ‚ 90% Unit / 100% E2E Coverage**.

---

## 2. Ø®Ø§Ø±Ø·Ø© Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ© (16 Sprint)

### ğŸ—ï¸ PHASE 1: PROVISIONING NUCLEUS (Sprints 1-4) - Ø¥Ù„Ø²Ø§Ù…ÙŠ ÙˆØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¬Ø§ÙˆØ²
**âš ï¸ ØªØ­Ø°ÙŠØ±:** Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Phase 2 Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø§Ø¬ØªÙŠØ§Ø² Ø¬Ù…ÙŠØ¹ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Phase 1.

#### Sprint 1: Foundation & S1 Compliance
**Ø§Ù„Ù…Ø¯Ø©:** 2 Ø£Ø³Ø§Ø¨ÙŠØ¹ | **Ø§Ù„ÙØ±ÙŠÙ‚:** Backend Lead + DevOps

| Ø§Ù„Ù…Ù‡Ù…Ø© | Ø§Ù„ØªÙØ§ØµÙŠÙ„ | Definition of Done |
|--------|----------|-------------------|
| Monorepo Setup | Turborepo + Bun RuntimeØŒ Ø¥Ø¹Ø¯Ø§Ø¯ `apps/*` Ùˆ `packages/*` | `bun turbo run build` ÙŠÙ†Ø¬Ø­ Ø¨Ø¯ÙˆÙ† Ø£Ø®Ø·Ø§Ø¡ |
| Docker Stack | PostgreSQL (pgvector), Redis, MinIO, Traefik, Mailpit | `docker compose ps` ÙŠØ¸Ù‡Ø± ALL HEALTHY |
| S1: Environment Verification | `@apex/config` Ù…Ø¹ Zod Schema | App ÙŠØªÙˆÙ‚Ù Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ Ø¥Ø°Ø§ JWT_SECRET ØºÙŠØ± ØµØ§Ù„Ø­ |

**Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ù„Ø²Ø§Ù…ÙŠ (100%):**
```bash
JWT_SECRET="short" â†’ App Crash: "S1 Violation: JWT_SECRET malformed"
JWT_SECRET="valid-256-bit-key" â†’ App Boot Success
```

#### Sprint 2: Tenant Isolation (S2) - Ø­Ø¬Ø± Ø§Ù„Ø£Ø³Ø§Ø³ Ø§Ù„Ø£Ù…Ù†ÙŠ
**Ø§Ù„Ù…Ø¯Ø©:** 2 Ø£Ø³Ø§Ø¨ÙŠØ¹ | **Ø§Ù„ÙØ±ÙŠÙ‚:** Backend Security Lead

| Ø§Ù„Ù…Ù‡Ù…Ø© | Ø§Ù„ØªÙØ§ØµÙŠÙ„ | Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠ |
|--------|----------|------------------|
| S2 Middleware | Ø§Ø³ØªØ®Ø±Ø§Ø¬ Subdomain â†’ `SET search_path = tenant_{id}, public` | Test: Request Ù„Ù€ `tenant-a` Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª `tenant-b` â†’ 403 |
| TenantScopedGuard | Ù…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ø¹Ø¨Ø± Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ† Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Controller | S4: ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ ÙÙŠ Audit Logs |
| S3: Input Validation | Global `ZodValidationPipe`ØŒ Strip Unknown Properties | Ø£ÙŠ Input ØºÙŠØ± ØµØ§Ù„Ø­ â†’ 400 Bad Request |

**E2E Test Ø¥Ù„Ø²Ø§Ù…ÙŠ:**
```typescript
test('S2: Cross-Tenant Access Prevention', async () => {
  const tenantA = await createTenant('alpha');
  const tenantB = await createTenant('beta');
  const product = await createProduct(tenantB.id, 'Secret');
  
  const res = await request(app)
    .get(`/api/products/${product.id}`)
    .set('X-Tenant-ID', tenantA.id);
    
  expect(res.status).toBe(403);
  expect(auditLogs).toContain({
    action: 'CROSS_TENANT_ACCESS_ATTEMPT',
    tenant_id: tenantA.id
  });
});
```

#### Sprint 3: Security Core (S4, S5, S6)
**Ø§Ù„Ù…Ø¯Ø©:** 2 Ø£Ø³Ø§Ø¨ÙŠØ¹

- **S4: Audit Logging Interceptor**
  - NestJS Interceptor + AsyncLocalStorage.
  - ØªØ³Ø¬ÙŠÙ„ ÙƒÙ„ Write Operation (User, Action, Tenant, IP, Before/After).
  - **Immutable:** Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø­Ø°Ù.

- **S5: Exception Filter**
  - No Stack Traces in Production.
  - GlitchTip Integration.

- **S6: Rate Limiting**
  - Redis-basedØŒ Dynamic Limits (Free: 100 req/min, Pro: 1000 req/min).
  - IP Blocking Ø¨Ø¹Ø¯ 5 Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…Ø®Ø§Ù„ÙØ©.

#### Sprint 4: Provisioning Engine (Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø°Ù‡Ø¨ÙŠ <60 Ø«Ø§Ù†ÙŠØ©)
**Ø§Ù„Ù…Ø¯Ø©:** 2 Ø£Ø³Ø§Ø¨ÙŠØ¹ | **Ø§Ù„ÙØ±ÙŠÙ‚:** Backend Lead + DevOps

**Ø§Ù„Ø®Ø·ÙˆØ§Øª:**
1. CLI Script: `bun run provision:tenant --name=store`
2. Create Schema `tenant_store`
3. Run Migrations + Seed Data (Ù…Ù† Onboarding Blueprint)
4. Create MinIO Bucket
5. Register in Traefik (Dynamic Routing)
6. **Timing Gate: â‰¤ 55 seconds** (PagerDuty Alert Ø¹Ù†Ø¯ 50s)

**Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©:**
```bash
# Timing Test
time bun run provision:tenant --name=perf-test
# Expected: real 0m52.123s (â‰¤ 55s)

# Idempotency Test
bun run provision:tenant --name=duplicate â†’ HTTP 409 Conflict
```

---

### ğŸ›’ PHASE 2: TENANT MVP (Sprints 5-8)

#### Sprint 5-6: Storefront & Checkout
- Store-#01: Home Page (Dynamic Sections).
- Store-#03: Product Details (PDP) Ù…Ø¹ Variants.
- Store-#06: Checkout One-Page (Stripe Elements).
- Admin-#17: Order Management (Status Workflow).

#### Sprint 7: RBAC & Access Control
- Admin-#27: Staff RBAC (Super Admin, Admin, Manager, Viewer).
- **Test:** Staff Ø¨Ù€ "Viewer" role Ù„Ø§ ÙŠØ±Ù‰ Ø²Ø± "Delete Product".
- Admin-#01: Identity Settings (Logo Upload â†’ MinIO).

#### Sprint 8: Performance & Polish
- Store-#37: Global Search (pgvector).
- Lighthouse Score â‰¥ 90.
- Store-#45: Cookie Consent (GDPR).

---

### ğŸŒ PHASE 3: PLATFORM SCALE (Sprints 9-16)

#### Sprint 9-10: Super Admin & Governance
- Super-#02: **God Mode** (Impersonation) - JWT Ù…Ø¹ `impersonating: true`.
- Super-#03: **Kill Switch** (Suspend Tenant â†’ 503 Maintenance).
- Super-#04: Resource Quotas (Max Products).
- Super-#07: Feature Gating (Plan-based).

#### Sprint 11-12: Audit & Backups
- Super-#11: Global Audit Log (Cross-Tenant, Immutable).
- Super-#18: Database Snapshots (`pg_dump` â†’ MinIO).
- Super-#22: Page Builder (CMS).

#### Sprint 13-14: Mobile & Server-Driven UI (4 Ø£Ø³Ø§Ø¨ÙŠØ¹)
- Mobile App (Expo) - Generic Binary.
- Endpoint: `GET /api/mobile/config?domain=tenant.apex.com`.
- **Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:** ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† ÙÙŠ Admin â†’ ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø¨Ø¯ÙˆÙ† rebuild.

#### Sprint 15-16: AI & Advanced
- Admin-#34: AI Content Writer (OpenAI).
- Admin-#35: AI Image Enhancer (BullMQ Background Jobs).
- Admin-#39: Fraud Detection (Risk Score).
- Store-Adv-B2B: B2B Portal.

---

## 3. Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø£Ù…Ø§Ù† (S1-S8 Checklist)

| Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ | Ø§Ù„ØªÙ†ÙÙŠØ° | Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± |
|------------|---------|----------|
| **S1** | Zod Validation Ù„ÙƒÙ„ Env VarØŒ App Crash Ø¹Ù„Ù‰ Invalid | `JWT_SECRET=invalid` â†’ Crash |
| **S2** | Schema-based IsolationØŒ `TenantScopedGuard` | Cross-Tenant Access â†’ 403 |
| **S3** | Global `ZodValidationPipe`ØŒ No `any` Types | Invalid Input â†’ 400 |
| **S4** | Interceptor Ø¹Ù„Ù‰ ÙƒÙ„ WriteØŒ Immutable Logs | Audit Table ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© |
| **S5** | Exception FilterØŒ No Stack Traces | GlitchTip ÙŠØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ |
| **S6** | Redis ThrottlingØŒ IP Blocking | 101st Request â†’ 429 |
| **S7** | AES-256-GCM Ù„Ù„Ù€ PIIØŒ TLS 1.3 | DB ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ciphertext ÙÙ‚Ø· |
| **S8** | Helmet (CSP, HSTS)ØŒ Dynamic CORS | Headers Check |

---

## 4. Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª (Test Coverage)

### Unit Tests (90% Coverage) - Vitest
- Domain Logic (Checkout, Pricing).
- Zod Schema Validation (All Edge Cases).
- **Rule:** No PR Merge without 90% Coverage.

### E2E Tests (100% for Critical Paths)
1. **North Star Test:** Landing â†’ Payment â†’ Provisioning â‰¤ 60s.
2. **Tenant Isolation Test:** Cross-Tenant Access Prevention.
3. **RBAC Test:** Viewer cannot Delete.
4. **Checkout Flow:** Cart â†’ Payment â†’ Email Confirmation.
5. **Mobile SDUI:** Runtime Branding Change.

### Performance Tests
- Provisioning: â‰¤ 55 seconds.
- API Latency: p95 < 200ms.

---

## 5. Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ­ÙˆØ§Ø¬Ø² Ø§Ù„Ù†Ø´Ø±

### Pre-Commit (Husky)
```bash
biome check --apply .
bun run test:unit --run
```

### Pull Request Requirements
1. **Biome:** Zero Lint Errors.
2. **Tests:** Unit â‰¥ 90%, Integration â‰¥ 85%.
3. **S2 Check:** Cross-Tenant Safety Verified.
4. **Architect Approval:** Ù„Ù„Ù€ Cross-Module Changes.

### Deployment Gates
- Staging E2E Pass.
- Security Scan: No High/Critical Vulnerabilities.
- Performance: Provisioning < 55s.

---

## 6. Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙˆØ®Ø·Ø· Ø§Ù„ØªØ®ÙÙŠÙ

| Ø§Ù„Ù…Ø®Ø§Ø·Ø± | Ø§Ù„ØªØ£Ø«ÙŠØ± | Ø§Ù„ØªØ®ÙÙŠÙ |
|---------|---------|---------|
| **Cross-Tenant Data Leak** | Catastrophic | S2 Middleware + 100% E2E Isolation Tests + Manual Audit ÙƒÙ„ Sprint |
| **Provisioning Timeout** | High | Monitoring at 50s â†’ Alert at 55s â†’ Auto-Rollback |
| **Mobile Rebuild Required** | Medium | Server-Driven UI Strict Implementation |
| **Schema Migration Failure** | High | Idempotent Migrations + Backup before Deploy |

---

## âœ… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡

- [ ] Ø¬Ù…ÙŠØ¹ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚ Ù‚Ø±Ø£ÙˆØ§ Constitution & Roadmap.
- [ ] Biome Ù…Ø«Ø¨Øª ÙÙŠ ÙƒÙ„ IDE (Format on Save).
- [ ] Docker Desktop Ù…Ø«Ø¨Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©.
- [ ] Bun Runtime Ù…Ø«Ø¨Øª (v1.0+).
- [ ] GitHub Protected Branches (main requires PR + 2 Reviews + Architect Approval).
- [ ] GlitchTip Project Created.
- [ ] PagerDuty Alerts Configured (Ù„Ù„Ù€ Provisioning Timeout).

---

**Ù…Ù„Ø§Ø­Ø¸Ø© ØªÙ†ÙÙŠØ°ÙŠØ©:** Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø© Ù…Ù„Ø²Ù…Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚. Ø£ÙŠ Ø§Ù†Ø­Ø±Ø§Ù ÙŠØªØ·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© ÙƒØªØ§Ø¨ÙŠØ© Ù…Ù† Lead Architect Ù…Ø¹ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø³Ø¨Ø¨ ÙÙŠ `/docs/adrs/`.

**Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°:**
- [ ] Lead Architect
- [ ] CTO  
- [ ] Product Owner

**Ø§Ù„ØªØ§Ø±ÙŠØ®:** _______________

---
**Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©:** Constitution-2026-01, Roadmap-2026-01, Architecture-S1-S8, Plan-143-Requirements.